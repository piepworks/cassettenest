{% load waffle_tags %}
<div id="subscription" class="subscription-settings">
    <h2>Manage your subscription</h2>
    {% if user.is_staff or user.profile.friend %}
        <p>Youâ€™re a friend of Trey Labs and you donâ€™t need to subscribe! ðŸ–¤</p>
        <p class="subscription-note">Thank you for your help in creating Cassette Nest!</p>
    {% else %}
        <div class="js-required">
            {% if not user.profile.has_active_subscription %}
                <h3>Youâ€™re not currently subscribed. Please choose a plan.</h3>

                {% if trial.enabled %}
                    <p>Try it free for <strong>{{ trial.duration }} days!</strong></p>
                {% endif %}

                <p class="policies">By subscribing, you agree to our <a href="https://cassettenest.com/policies/terms/" target="_blank" rel="noopener">Terms of Service</a> and <a href="https://cassettenest.com/policies/privacy/" target="_blank" rel="noopener">Privacy Policy</a>.</p>

                {% flag 'paddle' %}
                <div class="subscription-plans">
                    <button class="paddle-subscribe" data-product="{{ paddle.standard_monthly }}"><span class="paddle-gross" data-product="{{ paddle.standard_monthly }}">$2</span> per month</button>
                    <button class="paddle-subscribe" data-product="{{ paddle.standard_annual }}"><span class="paddle-gross" data-product="{{ paddle.standard_annual }}">$20</span> per year</button>
                </div>
                {% endflag %}

            {% else %}
                <p>Youâ€™re currently subscribed to the <b>{{ paddle.plan_name }}</b> plan.</p>

                {% if user.profile.subscription_status == 'trialing' %}
                    <p>Your free trial will end in <strong>{{ user.profile.trial_days_remaining }} day{{ user.profile.trial_days_remaining|pluralize }}</strong>.</p>
                {% endif %}

                <div class="subscription-plans">
                    <button class="paddle-update">Update your payment method.</button>
                    <button class="secondary paddle-cancel">Cancel your subscription.</button>
                </div>
            {% endif %}
        </div>
        <div class="no-js">
            <p>Sorry, subscription management requires JavaScript to work. :(</p>
        </div>
        {% flag 'paddle' %}
            <p class="subscription-note">Easy and secure billing management with <a href="https://paddle.com" target="_blank" rel="noopener">Paddle</a>. Cancel any time.</p>
        {% endflag %}
    {% endif %}
</div>
