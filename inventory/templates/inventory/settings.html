{% extends 'base_site.html' %}
{% load waffle_tags %}

{% block title %}Settings{% endblock %}
{% block bodytag %}class="settings"{% endblock %}

{% block content %}
<div class="raw">
    <h1>Settings</h1>

    {% flag 'paddle' %}
    {% include 'inventory/_settings-subscription.html' %}
    {% endflag %}

    <form method="post" class="pt-3 pb-20">
        {% csrf_token %}
        {% for field in user_form %}
            {% include 'components/form-field.html' with field=field %}
        {% endfor %}
        {% for field in profile_form %}
            {% include 'components/form-field.html' with field=field %}
        {% endfor %}
        <div class="field">
            <label>Password</label>
            <div><a href="{% url 'password_change' %}">Change your password</a></div>
        </div>
        <div class="action"><button class="primary">Save settings</button></div>
    </form>


    {% flag 'export-data' %}
    {% if exportable_data %}
    <hr />

    <h2 id="export">Export your data</h2>
    <ul>
        {% for k, v in exportable.items %}
            {% if v %}
                <li><a href="{% url 'export-'|add:k %}">Download your {{ k }} data.</a></li>
            {% endif %}
        {% endfor %}
    </ul>
    {% endif %}
    {% endflag %}

    {% flag 'import-data' %}
    <hr />

    <h2 id="import">Import previously exported data</h2>
    <ul>
        {% for import in imports %}
            <li>
                {{ import }}
                <form method="post" action="{% url 'import-'|add:import|lower %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ csv_form.csv }}
                    <input type="submit" value="Upload" />
                </form>
            </li>
        {% endfor %}
    </ul>
    {% endflag %}
</div>
{% endblock %}

{% block page_js %}
{% flag 'paddle' %}
    <script src="https://cdn.paddle.com/paddle/paddle.js"></script>
    {% include 'inventory/_settings-subscription-js.html' %}
{% endflag %}
{% endblock %}
