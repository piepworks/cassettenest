{% extends 'base_site.html' %}
{% load waffle_tags %}

{% block title %}Settings{% endblock %}
{% block bodytag %}class="settings"{% endblock %}

{% block content %}
<div class="raw">
    <h1>Settings</h1>

    {% flag 'paddle' %}
    {% include 'inventory/_settings-subscription.html' %}
    {% endflag %}

    <form method="post" class="pt-3 pb-20">
        {% csrf_token %}
        {% for field in user_form %}
            {% include 'components/form-field.html' with field=field %}
        {% endfor %}
        {% for field in profile_form %}
            {% include 'components/form-field.html' with field=field %}
        {% endfor %}
        <div class="field">
            <label>Password</label>
            <div><a href="{% url 'password_change' %}">Change your password</a></div>
        </div>
        <div class="action"><button class="primary">Save settings</button></div>
    </form>


    {% flag 'export-data' %}
    {% if exportable_data %}
    <dl id="export" class="text-sm font-medium">
        <dt>Export your data</dt>
        <dd class="mt-2">
            <ul class="divide-y divide-stone-300 dark:divide-stone-600 rounded-md border border-stone-300 dark:border-stone-600">
                {% for k, v in exportable.items %}
                    {% if v %}
                        <li class="flex items-center justify-between py-3 pl-3 pr-4">
                            <div class="flex w-0 flex-1 items-center">
                                {% include 'svg/heroicons/paper-clip.svg' with class='h-5 w-5 flex-shrink-0 text-stone-400 dark:text-stone-500' %}
                                <span class="ml-2 w-0 flex-1 truncate">Your {{ k }}</span>
                            </div>
                            <div class="ml-4 flex-shrink-0">
                                <a href="{% url 'export-'|add:k %}">Download</a>
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </dd>
    </dl>
    {% endif %}
    {% endflag %}

    {% flag 'import-data' %}
    <h2 id="import">Import previously exported data</h2>
    <ul>
        {% for import in imports %}
            <li>
                {{ import }}
                <form method="post" action="{% url 'import-'|add:import|lower %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ csv_form.csv }}
                    <input type="submit" value="Upload" />
                </form>
            </li>
        {% endfor %}
    </ul>
    {% endflag %}
</div>
{% endblock %}

{% block page_js %}
{% flag 'paddle' %}
    <script src="https://cdn.paddle.com/paddle/paddle.js"></script>
    {% include 'inventory/_settings-subscription-js.html' %}
{% endflag %}
{% endblock %}
