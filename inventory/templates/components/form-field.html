{% load widget_tweaks %}
{% load capture_tags %}

{% if field.field.widget.input_type == 'hidden' %}
    {{ field }}
{% else %}
<div
    class="field {% if not field.field.widget.input_type %} field--textarea
        {% else %} field--{{ field.field.widget.input_type }}{% endif %}
        {% if progressive %} field--progressive
            {% if primary %} field--progressive-primary{% endif %}
        {% endif %}
        {% if top_field %} field--progressive__top{% endif %}"
    {% if progressive_text %} data-progressive-text="{{ progressive_text }}"{% endif %}
    {% if label_override %} data-label-override="{{ label_override }}"{% endif %}
    {% if show_first %} data-show-first="self"{% endif %}
    data-label="{{ field.field.label }}"
    {% if progressive %} x-show="{{ primary|yesno:'primary,!primary' }}"{% endif %}>
    {% if field.field.widget.input_type == 'checkbox' %}
        {% if field|length > 1 %}
            <fieldset>
                <legend class="font-bold">{{ field.label }}</legend>
                {% if field.help_text %}
                    <div class="text-sm text-stone-500 dark:text-stone-300 prose dark:prose-invert">{{ field.help_text }}</div>
                {% endif %}
                <div class="mt-3 space-y-2">
                    {% for f in field %}
                        <div class="flex items-center h-5">{{ f }}</div>
                    {% endfor %}
                </div>
            </fieldset>
        {% else %}
            <div class="relative flex items-start">
                <div class="flex items-center h-5">
                    {{ field }}
                </div>
                <div>
                    <label for="{{ field.id_for_label }}" class="font-medium">{{ field.label }}</label>
                    {% if field.help_text %}
                        <div class="mt-2 text-sm text-stone-500 dark:text-stone-300 prose dark:prose-invert">{{ field.help_text }}</div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% elif field.field.widget.input_type == 'radio' %}
        <fieldset>
            <legend>{{ field.label }}</legend>
            {% if field.help_text %}
                <div class="text-sm text-stone-500 dark:text-stone-300 prose dark:prose-invert">{{ field.help_text }}</div>
            {% endif %}
            <div class="mt-3 space-y-2">
                {% for f in field %}
                    <div class="flex items-center h-5">{{ f }}</div>
                {% endfor %}
            </div>
        </fieldset>
    {% else %}
        <label class="block text-sm font-medium" for="{{ field.id_for_label }}"{% if label_override %} x-text="'{{ label_override }}'"{% endif %}>{{ field.label }}</label>
        {% if not field.field.widget.input_type %}
            {% include 'components/form-markdown-toolbar.html' with id=field.id_for_label %}
        {% endif %}
        {% if enhanced_label.before %}
            <span class="subdued"{% if enhanced_label.before_tooltip %} title="{{ enhanced_label.before_tooltip }}"{% endif %}>{{ enhanced_label.before }}</span>
        {% endif %}

        {% capture as xref silent %}{{ primary|yesno:'primary,secondary' }}{% endcapture %}

        <div class="mt-1">
            {% if not field.field.widget.input_type %}
                {# Set autocomplete on Markdown textareas. #}
                {% render_field field x-ref=xref x-data='' x-on::keyup.enter="checkAutocomplete($el)" %}
            {% else %}
                {% render_field field x-ref=xref %}
            {% endif %}
        </div>
        {% if field.help_text and field.label != 'Username' %}
            <div class="mt-2 text-sm text-stone-500 dark:text-stone-300 prose dark:prose-invert">{{ field.help_text }}</div>
        {% endif %}

        {% if enhanced_label.after %}
            <span class="subdued"{% if enhanced_label.after_tooltip %} title="{{ enhanced_label.after_tooltip }}"{% endif %}>{{ enhanced_label.after }}</span>
        {% endif %}
    {% endif %}
    {% if progressive %}
        <div class="js-link">
            <a @click="primary = !primary; $nextTick(() => $refs.{{ primary|yesno:'secondary,primary' }}.focus())" tabindex="0">{{ progressive_text }}</a>
        </div>
    {% endif %}
</div>
{% endif %}
